---
layout: article
---
Теперь очередь Jenkins. Я перешел в Jenkins UI, там выбрал `Manage Jenkins -> Credentials`.

В разделе глобальных записей добавил облачные ssh-ключи и IAM-ключи юзера **jenkins-provisioner**.

Там нет ничего сложного, в учётке для ssh-ключей укажи пользователя `ec2-user` и вставь закрытый ключ, полученный из облака.

После этого, я перешел в уже знакомый нам `Manage Jenkins -> Clouds -> New cloud` и создал AWS cloud. Название будет `ec2`.

В следующем длинном диалоге в пунктах `Amazon EC2 Credentials` и `EC2 Key Pair's Private Key` я указал использовать только что созданные креденшилс, а также выбрал в пункте `Region` то место, где я хочу, чтобы инстансы создавались. К тому же региону должны принадлежать и ключи.

Далее нажму `Test Connection Success` и проверю корректность. Вот в этом месте лучше сохраниться, поскольку если ошибешься дальше, все придется вводить заново.

Открываю раздел `AMIs`. Устанавливаю `Description` в `agent-aws`.

`AMI ID` в `ami-03eb6185d756497f8` - это `Amazon Linux2`, и это не самый современный образ. Как ты помнишь Jenkins требуется Java. Если ее не будет в образе, плагин ее поставит. Самостоятельно он ставит `java11`, и вот с ней проблемы в `Amazon Linux 23`.

Вообще-то, для таких вещей стоит использовать собственный кастомный `AMI`, в котором ты будешь полностью уверен.

Следующий пункт `Instance Type`, ставлю его в `T2Micro`.

В `Security group names` ставлю группу `jenkins-agents`. Эту группу я создал специально для того, чтобы инстанс был доступен из интернета.

Пункт `Remote FS root` установлю указывающий на домашнюю директорию `/home/ec2-user`.

`Remote user` будет `ec2-user`. `AMI Type` в `unix`. Поле меток указывает на название агента. Установлю `Labels` в `ec2`, а `Usage` в `Only build jobs with label expressions matching this node`.

Вот здесь я советую сохраниться второй раз.

Последняя группа параметров для настройки находится под `Advanced`. Поскольку инстанс с Jenkins у меня в Яндекс-облаке, а агент будет в AWS, то мне нужно будет создать экземпляр агента с внешним IP и обращаться к нему по этому адресу.

Установлю галочку на `Associate Public IP`. В `Connection Strategy` выберу `Public IP`. `Host Key Verification Strategy` установлю в `off`.

Сохраню. Теперь готово. Мы его настроили.

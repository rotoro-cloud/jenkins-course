---
layout: article
---
Но во многих случаях нам удобнее и экономнее делать задания одновременно.

Иногда это могут быть похожие задачи - например сборка бинарников под разные архитектуры или нагрузочные тесты. Иногда совсем разные. Например, одновременное создание компонентов среды для тестирования.

Главное, что объединяет эти задачи, в том, что мы хотим, чтобы эти stages исполнялись одновременно. Это ускорит билд. Также, если какие-то из этих фаз некритичные и допустимо, что они упадут, мы могли бы спасти остальной пайплайн.

Ок, вот знакомый нам Jenkinsfile, мы его уже не раз запускали. Здесь три последовательные стадии: тестирование, сборка и запуск на агенте.

```groovy
pipeline {
    agent any
    tools {
        go 'go-1.20'
    }
    stages {
        stage('test') {
            steps {
                git 'https://github.com/rotoro-cloud/go-webapp-sample.git'
                sh 'go test ./...'
            }
        }
        stage('build') {
            steps {
                sh 'go build .'
                sh 'cp -f ./go-webapp-sample /tmp/'
            }
        }
        stage('run') {
            steps {
                sh 'export JENKINS_NODE_COOKIE=dontKillMe && /tmp/go-webapp-sample &'
            }
        }
    }
}
```

`Golang` - язык компилируемый, и за его производительность мы платим необходимостью собирать отдельные версии исполняемого файла под отдельные ОС и архитектуры.

К счастью, go умеет это делать в одном месте, я имею в виду, что сборка exe-файла под Windows может быть успешно проведена на машине с Linux. С запуском файла такое не получится, но со сборкой без проблем.

---
layout: article
---
Я открою файл из третьей папки, которая `multi-stage`. Давай посмотрим на многоступенчатый конвейер. У нас опять настроена структура `pipeline -> stages -> steps`. Мы опять указали, чтобы Jenkins использовал любого агента. Но у нас здесь две **stages**.

Внутри блока stages у нас теперь два блока с ключевым словом stage и фигурными скобками. Первая stage называется `Dev`, вторая `build`. На каждом из этих stages, т.е. на этапе разработки и на этапе сборки, у нас есть собственные steps. 

Здесь оба эти шага делают одно и то же. Это для того, чтобы не перегружать мозги новичка дополнительной информацией. Я просто показал, как описать многоступенчатый конвейер.

Обычно мы используем многоступенчатые конвейеры в действительно сложных задачах, когда, в зависимости от настроек, переданных в скрипт конвейера, мы можем сильно менять поведение пайплайна. Мы можем так написать логику конвейера, чтобы исполнять только определенные stages или даже steps. Мы можем исполнять stages на разных агентах. Мы можем сохранять или не сохранять изготовленные в процессе работы артефакты и т.д.

Поэтому в реальном мире блоков stage обычно несколько, в них, скорее всего, будут проверяться какие-то условия, вроде имени ветки, из которой пришел коммит. Также часто бывает описание, на каком агенте нужно исполнять эту stage. У нас в примере исполнение будет в таком порядке: сначала отработает stage `Dev`, потом `build`.

---
layout: article
---
Вернемся в Jenkins. Моя виртуалка с **1 CPU**, и здесь я ставлю в `executors` 1.

Затем удаленный каталог. Это каталог, в котором будет происходить работа Jenkins. Мы просто укажем `/home/jenkins/agent`. Это каталог нашего пользователя, которого мы используем. Папка `agent` в нем пока отсутствует, но она будет создана автоматически.

Кроме того, что в этой папке будут находится временные файлы, которые нужны для сборки, здесь также будут лежать **tools**, указанные, как необходимые для сборки. Поэтому лучше не устанавливать этот каталог как `/tmp`, который очищается после перезагрузки агента.

Я добавлю `ubuntu-agent01` в `Labels`. Меток может быть несколько. Этот пункт нужен, для того, чтобы мы могли гибко назначать наши сборки на отдельные агенты. Эти метки мы указываем в параметре `agent` нашего пайплайна.

В пункте `Usage` оставим, чтобы использовал эту ноду как можно чаще. Второй вариант здесь - использовать только, если совпадает метка. Таким образом, если выбрать вторую стратегию, пайплайны с `node any` сюда никогда не попадут. Эта нода будет брать только те, что будут явно иметь метку `ubuntu-agent01`.

`Launch method` установим в значение, чтобы запуск был через SSH. В этом случае контроллер будет сам инициировать соединение с нодами. Иногда случается, что ноды находятся за NAT, и прямое обращение к ним невозможно. В таких случаях нам потребуется другая опция, когда агенты сами спрашивают контроллер, есть ли для них задания.

В поле `Host` впишем IP агента, поскольку мой инстанс не имеет настроенного DNS-имени.

В `Credentials` выберу созданные для пользователя `jenkins` учетные данные. Это то, что мы создавали в начале этого демо.

Затем, в разделе `Host Key Verification Strategy` выставлю значение, чтобы система не проверяла их. Эта настройка аналогична опции `StrictHostKeyChecking` команды ssh. Таким образом если захочешь включить эту проверку, убедись что в домашнем каталоге юзера `jenkins` есть файл `.ssh/known_hosts`, и в нем присутствует публичный ssh-ключ агента. Тогда Jenkins сможет подключить агента при активной опции `Known hosts file Verification Strategy`.

Дальше под `Advanced` идет много пунктов, такие как настройки кастомных путей для Java-машины, лимиты на повторения и другие опции тонкой настройки. Это подкручивается индивидуально под свои нагрузки методом проб и ошибок.

Меня здесь интересует пункт `Availability`. Агенты работают не постоянно. Особенно агенты со специфическим железом. Скажем это облачные инстансы с GPU. Держать простаивающими такие агенты может быть очень расточительно.

Jenkins дает нам возможность гибко настроить своих агентов, чтобы они выключались по расписанию, скажем на выходные, а потом снова включались, или же, чтобы они поднимались только когда для них появились задания. Нам не требуется эта возможность прямо сейчас, но об этом следует помнить.

Ок, всё, мы готовы нажать `Save`. Как видишь у меня узел в `offline`. Нужно зайти на эту новую ноду и взглянуть на детали узла.

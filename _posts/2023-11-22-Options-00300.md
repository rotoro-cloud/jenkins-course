---
layout: article
---
```groovy
pipeline {
    agent none
    stages {
        stage('first') {
            agent any
            input {
                message "Are you here?"
                ok "Submit"
            }
            steps {
                echo 'Ok'
            }
        }
        stage('second') {
            steps {
                sh "echo Now: $(date '+%Y-%m-%d %H:%M:%S')"
            }
        }
    }
}
```

Я поменял наш Jenkisfile и хочу реализовать очень жизненный кейс, а именно, что, если пользователь не вводит данные дольше 30 секунд, то отменять сборку. Для этого мне понадобится механизм `input`, который ждет данные от запустившего пайплайн пользователя. Мы разберем `input` подробнее уже скоро в курсе.

Сейчас же я просто хочу ограничить время ввода, чтобы конвейер останавливался, если данные не введены больше 30 секунд. Для этого я использовал механизм `timeout`, установив его в опциях стадии `first`.

Теперь мой пайплайн выглядит так (в репозитории пример с именем `Jenkinsfile-8.30-3`):

```groovy
pipeline {
    agent none
    stages {
        stage('first') {
            agent any
            input {
                message "Are you here?"
                ok "Submit"
            }
            options {
                timeout(time: 30, unit: 'SECONDS')
            }
            steps {
                echo 'Ok'
            }
        }
        stage('second') {
            steps {
                sh "echo Now: \$(date '+%Y-%m-%d %H:%M:%S')"
            }
        }
    }
}
```

Запущу на исполнение и зайду в логи. Как и ожидалось, по прошествии 30 секунд не дождавшись ввода наша сборка перешла в статус `ABORTED`. Если перезапустить job и успеть подтвердить за 30 секунд, то сборка будет успешной.

Ок, но что если я что-то слышал про опцию `timeout`, но совершенно не помню, как это использовать? 

При создании pipeline ты наверное видел ссылку `pipeline-syntax`. Но эта штука не проверяет Jenkinsfile на синтаксис, т.к. проверка в браузере проходит автоматически. А вот нажав на эту ссылку ты попадёшь в интересное место, которое называется `Snippet Generator`. Если отсюда перейти в `Declarative Directive Generator`, мы попадем в инструмент, который помогает нам создавать директивы пайплайна. Мы можем просмотреть на представленные варианты, с чем нам может помочь этот генератор и создать через форму декларативную команду, которую потом скопипастить себе в пайплайн. Нас интересуют опции, поэтому в выпадающем списке я выберу **options**. Далее под кнопкой `Add` я поищу по слову `time`. Теперь выберу `timeout`. Появляется форма с доступными параметрами, это длительность и единицы измерения. Мне нужно 30 секунд.

Осталось нажать кнопку генерации и добавить в пайплайн.

Ок, на моей практике работы с Jenkins это достаточно частый кейс, когда активность пользователя нужно ограничивать по таймауту. Часто поскольку многие пользователи могут забыть ввести какие-то параметры после запуска, а этот механизм своего рода предохранитель.

И это все, увидимся.

---
layout: article
---
Условия в pipeline делятся на 2 группы. Первая история про декларативный блок `when`, когда мы определяем, будет ли выполняться определенный stage. Второй вариант используется в steps, и он относится к скриптовому подходу с операторами `if..else`.

Что касается `when`, то для реализации логики выбора, в него мы можем предать некоторые условия, и если они исполняются, stage будет выполнен. Несколько условий предаются при помощи операторов `allOf`, `anyOf`, `not`.

Это может быть достаточно гибко, поскольку мы можем ставить stages в параллельное исполнение и создавать вложенные stages.

Давай начнем с простого примера. Эти файлы есть в репозитории. Я просто обновлю значение в настройках своего задания **features**:

```
pipeline {
    agent any
    environment {
        access = 'granted'
    }
    stages {
        stage('first') {
            when {
                environment name: 'access', value: 'granted'
            }
            steps {
                echo "Just completed the first stage with ${env.access}"
            }
        }
    }
}
```

Итак, я объявил переменную `access` на уровне пайплайна, а далее установил условие, чтобы стадия `first` запускалась только, если эта переменная в значении `granted`. Давай проверим его в Jenkins. Файл в репо `Jenkinsfile-8.45-1`. Сохраняем, запускаем и видим в консоли, что стадия исполнена. В выводе также мы видим значение переменной, которое **granted**, такое же, как и в нашем условии **when**.Проверим обратное условие. Я просто изменю access = '' и запущу сборку.

```
pipeline {
    agent any
    environment {
        access = ''
    }
    stages {
        stage('first') {
            when {
                environment name: 'access', value: 'granted'
            }
            steps {
                echo "Just completed the first stage with ${env.access}"
            }
        }
    }
}
```

Как видишь, сборка успешна, но stage был пропущен из-за условия.

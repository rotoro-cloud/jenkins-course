---
layout: article
---
pipeline {
    agent any
    stages {
        stage('test') {
            steps {
                echo 'test'
            }
        }
    }

    post {
        always {
            echo 'Pipeline is done.'
        }
        success {
            echo 'Well, its successful!'
        }
        failure {
            echo 'Well, it failed!'
        }
        unstable {
            echo 'But its unstable'
        }
        changed {
            echo 'And this run has changed status after last build'
        }
        aborted {
            echo 'The build was aborted.'
        }
    }
}

```

В секции `post` есть пять блоков. Это по сути результаты завершения работы конвейера.

То, что находится в блоке `always` будет вызвано вне зависимости от результата работы, условием является просто завершение пайплайна.
`success` и `failure` - взаимоисключающие обработчики, возникающие при соответствующих статусах пайплайна.
Если билд в статусе `success`, но в нем найдены ошибки, на которые реагируют `publishers`, то билд становится в статус `unstable`. Если требуется отслеживать такое событие, то на это можно навесить свой `post-action`.
Что касается `publishers`, обычно они являются частью систем тестирования в процессах сборки, и именно архивы этих тестов мы можем видеть в деталях пайплайна.

Событие `changed` возникает, если предыдущая сборка изменила свой статус. Например, более ранняя была удачная, а текущая провалилась, или наоборот, старая не прошла, а эта удалась. В этих случаях сработает блок `changed`.

Статус `aborted` возникает при отмене сборки пользователем.

Давай соберем этот пайплайн. Как обычно, я создам его, вставив содержимое этого Jenkinsfile. Пошлю на запуск.

В логе мы видим, что произошли 3 события, на которые отреагировали наши post-хуки.

Сначала мы видим реакцию на событие `always`, далее на событие `changed`, поскольку у нас не было ни одной сборки (статус старого билда = `NOT_BUILT`), а у текущего он изменился на успешный (`SUCCESS`).
Третье возникшее событие `SUCCESS`, и на него у нас тоже сработал обработчик.

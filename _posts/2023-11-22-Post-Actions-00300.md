---
layout: article
---


```
pipeline {
    agent any
    stages {
        stage('test') {
            steps {
                echo 'test'
            }
        }
    }

    post {
        always {
            echo 'Pipeline is done.'
        }
        success {
            echo 'Well, its successful!'
        }
        failure {
            echo 'Well, it failed!'
        }
        unstable {
            echo 'But its unstable'
        }
        changed {
            echo 'And this run has changed status after last build'
        }
        aborted {
            echo 'The build was aborted.'
        }
    }
}

```

В секции `post` есть пять блоков. Это по сути результаты завершения работы конвейера.

- То, что находится в блоке `always` будет вызвано вне зависимости от результата работы, условием является просто завершение пайплайна.
- `success` и `failure` - взаимоисключающие обработчики, возникающие при соответствующих статусах пайплайна.
- Если билд в статусе `success`, но в нем найдены ошибки, на которые реагируют `publishers`, то билд становится в статус `unstable`. Если требуется отслеживать такое событие, то на это можно навесить свой `post-action`.

Что касается `publishers`, обычно они являются частью систем тестирования в процессах сборки, и именно архивы этих тестов мы можем видеть в деталях пайплайна.

- Событие `changed` возникает, если предыдущая сборка изменила свой статус. Например, более ранняя была удачная, а текущая провалилась, или наоборот, старая не прошла, а эта удалась. В этих случаях сработает блок `changed`.
- Статус `aborted` возникает при отмене сборки пользователем.

Давай соберем этот пайплайн. Я продолжу работать с заданием из предыдущей лекции, просто поменяю в нем Jenkinsfile на `Jenkinsfile-8.15-1`. Пошлю на запуск.

В логе мы видим вывод слова `test` - это функционал самой stage. Еще видим, что произошли 2 события, на которые отреагировали наши post-хуки.

Сначала идёт реакция на событие `always`, далее на событие `success`. Поскольку у нас уже были сборки в этом пайплайне в прошлой лекции, событие `changed` не сработало.

---
layout: article
---
Отлично! Но если ты присмотришься, то увидишь, что у нас есть `step`, в котором мы запускаем 
```
apk add build-base
```
Без этих инструментов сборки у нас не получится собрать go-приложение, а по умолчанию внутри образа их нет.

Мы решили проблему при помощи установки пакета через пакетный менеджер непосредственно в пайплайне. Альтернативно, мы могли бы каждый раз, когда запускается контейнер, копировать этот набор туда извне. Но есть способ лучше. Мы можем использовать `Dockerfile` в качестве агента.

В репозитории в этой же ветке есть такой Dockerfile, который строится от `golang:1.19-alpine`, а далее в него устанавливается `build-base` при помощи инструкции `RUN apk --no-cache add build-base`, как ты видишь.

```docker
FROM golang:1.19-alpine
RUN apk --no-cache add build-base
```

Теперь я снова изменю пайплайн, чтобы использовать Dockerfile из репо.

Захожу в редактирование и меняю Jenkinsfile на вот этот. Как видишь, агент теперь не `docker`, а `dockerfile`. Строка `args '-u root:root'` говорит докеру запускать контейнер от имени `root`, это для того, чтобы оставить пример простым. Обрати внимание на stage. В ней больше нет инструкции на установку build-base. 

```groovy
pipeline {
    agent {
        dockerfile { 
            args '-u root:root'
        }
    }
    stages {
        stage('test') {
            steps {
                git 'https://github.com/rotoro-cloud/go-webapp-sample.git'
                sh 'go test ./...'
                sh 'go version'
            }
        }
    }
}
```

